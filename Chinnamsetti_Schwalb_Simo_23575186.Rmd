---
title: "Horse Racing Data Analysis Project - ML1 HS24"
author: "sindhu.chinnamsetti@stud.hslu.ch, ronald.schwalb@stud.hslu.ch, eniko.simo@stud.hslu.ch"
date: "October 13th, 2024"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

# 1) Data Cleaning
<span style="color:red">WIP</span>


```{r}
# Import the Data from CSV Files
df1 <- read.csv("Lingfield_AW_2014_2024_flat.csv")
df2 <- read.csv("Lingfield_AW_2014_2024_jumps.csv")
df3 <- read.csv("Lingfield_turf_2014_2024_flat.csv")
df4 <- read.csv("Lingfield_turf_2014_2024_jumps.csv")

df.horse <- rbind(df1, df2, df3, df4)
```

- gotta diminish dataset size to: 
- max 10^5 = 100,000 rows
- 10-20 predictors

Keep the following columns based on domain knowledge and careful inspection of the dataset:

```{r}
df.horse <- subset(df.horse, select=c(date, race_name,type, class, dist_m, going, ran, pos, draw, horse, age, sex, lbs, hg, secs, jockey, trainer, prize))
```

Create a new column 'won', assigning 1 if 'pos' is 1, otherwise 0

```{r}
df.horse$won <- ifelse(df.horse$pos == 1, 1, 0)
# Check the first few rows to ensure the new column has been added
head(df.horse[c("pos","won")],50)
# => looks good
```

Check for missing values. NAs and empty strings
```{r}
colSums(is.na(df.horse) | df.horse == "")
```

```{r}
# let's drop hg and prize because most of them are missing
# but let's keep draw because AFAIK it might influence outcome
# keep it in mind that it only exists for Flat course type

df.horse <- subset(df.horse, select=-c(hg,prize))
```
Check datatypes. 
```{r}
str(df.horse)
```
Some variable types should be modified for better analysis. 

Convert 'date' column to date format
```{r}
df.horse$date <- as.Date(as.character(df.horse$date), format = "%Y-%m-%d")
```

```{r}
# Convert all character columns to factors
#df.horse[sapply(df.horse, is.character)] <- lapply(df.horse[sapply(df.horse, is.character)], as.factor)
# df.horse$race_name <- as.character(df.horse$race_name)
#df.horse$pos <- as.integer(as.character(df.horse$pos))
#df.horse$pos <- as.integer(df.horse$pos)
# Convert secs to numeric 
#df.horse$secs <- as.numeric(as.character(df.horse$secs))
```
```{r}
# check which values of pos can't be converted to integers
df.horse$pos_num <- as.integer(df.horse$pos)
df.horse[is.na(as.integer(df.horse$pos_num)), ]$pos
```

Meaning of the abbreviations:

**UR** (Unseated Rider): The jockey fell off during the race.
**PU** (Pulled Up): The horse was stopped by the jockey during the race due to an issue, usually to prevent injury.
**F** (Fell): The horse fell during the race.
**DSQ** (Disqualified): The horse was disqualified, usually for breaking rules like interference.
**RR** (Refused to Race): The horse refused to start the race.
**BD** (Brought Down): The horse was knocked down by another horse, usually in a fall.
Each of these indicates why a horse didn't complete the race as expected. Thus, these rows can be removed. 

NEXT: 
- do the same for secs
- convert pos into ordinal?
 

```{r}
# check the same for secs
df.horse$secs_num <- as.numeric(df.horse$secs)
df.horse[is.na(as.integer(df.horse$secs_num)), ]$secs
```

Log-transform “amounts” -> at prof's recommendation
In our dataset, these variables can be considered amounts:
- dist_m
- lbs
- secs
```{r}
# Log-transforming 'dist_m', 'lbs', and 'secs'
df.horse$log_dist_m <- log(df.horse$dist_m)
df.horse$log_lbs <- log(df.horse$lbs)
df.horse$log_secs <- log(df.horse$secs)
```

HOW TO VISUALIZE THE LOG AMOUNT TO COMPARE THEM WITH ORIGINAL??

Running the models take forever with our current dataset, so create a randomized sample with 10% of the data so that we can see results faster at this early stage of the project. 

```{r}
# Sample 10% of the dataset for testing
df.horse_sample <- df.horse[sample(nrow(df.horse), 0.1 * nrow(df.horse)), ]

dim(df.horse_sample)
```
# 2) Linear Model
Placeholder

# 3) Generalised Linear Model - Poisson
Placeholder

# 4) Generalised Linear Model - Binomial
WIP 
```{r}
glm.horse_sample <- glm(won ~ type + log_dist_m + going + age + sex + log_lbs + log_secs, 
                data = df.horse_sample,
                family = "binomial")
summary(glm.horse_sample)

```
<span style="color:red";>HOW TO INTERPRET ALL THESE FACTOR VARIABLES?
SHOULD THEY ALL BE FACTORS OR IS THERE A BETTER WAY?
I DON'T REMEMBER SO MANY FACTORS FROM THE LECTURES. </span>



# 5) Generalised Additive Model
Placeholder

# 6) Neural Network
Placeholder

# 7) Support Vector Machine
Placeholder

# 8) Use of Generative AI
Placeholder

# 9) Conclusion
Placeholder